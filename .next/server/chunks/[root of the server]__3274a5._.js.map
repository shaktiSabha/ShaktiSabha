{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 63, "column": 0}, "map": {"version":3,"sources":["file://D%3A/code/shakti-sabha/latest/ShaktiSabha/src/lib/mongodb.ts"],"sourcesContent":["import mongoose from 'mongoose';\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI || 'mongodb://localhost:27017/shakti-sabha';\r\n\r\nif (!MONGODB_URI) {\r\n  throw new Error('Please define the MONGODB_URI environment variable inside .env.local');\r\n}\r\n\r\n// Use mongoose connection state instead of custom flag\r\nasync function connectDB() {\r\n  // Check if already connected (0 = disconnected, 1 = connected, 2 = connecting, 3 = disconnecting)\r\n  if (mongoose.connection.readyState >= 1) {\r\n    return;\r\n  }\r\n\r\n  try {\r\n    await mongoose.connect(MONGODB_URI, {\r\n      // Connection pool settings to prevent ECONNRESET\r\n      maxPoolSize: 10,\r\n      minPoolSize: 2,\r\n      socketTimeoutMS: 45000,\r\n      serverSelectionTimeoutMS: 5000,\r\n      // Prevent connection issues\r\n      retryWrites: true,\r\n      retryReads: true,\r\n    });\r\n    console.log('MongoDB connected successfully');\r\n  } catch (error) {\r\n    console.error('MongoDB connection error:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\nexport default connectDB; "],"names":[],"mappings":";;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW,IAAI;AAE/C,uCAAkB;;AAElB;AAEA,uDAAuD;AACvD,eAAe;IACb,kGAAkG;IAClG,IAAI,yGAAA,CAAA,UAAQ,CAAC,UAAU,CAAC,UAAU,IAAI,GAAG;QACvC;IACF;IAEA,IAAI;QACF,MAAM,yGAAA,CAAA,UAAQ,CAAC,OAAO,CAAC,aAAa;YAClC,iDAAiD;YACjD,aAAa;YACb,aAAa;YACb,iBAAiB;YACjB,0BAA0B;YAC1B,4BAA4B;YAC5B,aAAa;YACb,YAAY;QACd;QACA,QAAQ,GAAG,CAAC;IACd,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,MAAM;IACR;AACF;uCAEe"}},
    {"offset": {"line": 96, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 102, "column": 0}, "map": {"version":3,"sources":["file://D%3A/code/shakti-sabha/latest/ShaktiSabha/src/models/Gallery.ts"],"sourcesContent":["import mongoose from 'mongoose';\r\n\r\nconst gallerySchema = new mongoose.Schema({\r\n  title: {\r\n    type: String,\r\n    required: [true, 'Title is required'],\r\n    trim: true,\r\n    maxlength: [200, 'Title cannot be more than 200 characters']\r\n  },\r\n  description: {\r\n    type: String,\r\n    required: [true, 'Description is required'],\r\n    trim: true,\r\n    maxlength: [1000, 'Description cannot be more than 1000 characters']\r\n  },\r\n  imageUrl: {\r\n    type: String,\r\n    required: [true, 'Image URL is required']\r\n  },\r\n  imagePublicId: {\r\n    type: String, // For Cloudinary image management\r\n    required: true\r\n  },\r\n  category: {\r\n    type: String,\r\n    required: [true, 'Category is required'],\r\n    enum: ['Workshops', 'Community', 'Training', 'Events', 'Conferences', 'Other'],\r\n    default: 'Other'\r\n  },\r\n  alt: {\r\n    type: String,\r\n    required: [true, 'Alt text is required for accessibility'],\r\n    trim: true,\r\n    maxlength: [200, 'Alt text cannot be more than 200 characters']\r\n  },\r\n  status: {\r\n    type: String,\r\n    enum: ['draft', 'published'],\r\n    default: 'draft'\r\n  },\r\n  views: {\r\n    type: Number,\r\n    default: 0\r\n  },\r\n  featured: {\r\n    type: Boolean,\r\n    default: false\r\n  },\r\n  uploadedBy: {\r\n    type: String,\r\n    default: 'Admin User'\r\n  }\r\n}, {\r\n  timestamps: true // This adds createdAt and updatedAt fields automatically\r\n});\r\n\r\n// Create indexes for better performance\r\ngallerySchema.index({ category: 1, status: 1, createdAt: -1 });\r\ngallerySchema.index({ featured: 1, status: 1 });\r\ngallerySchema.index({ title: 'text', description: 'text' });\r\n\r\nconst Gallery = mongoose.models.Gallery || mongoose.model('Gallery', gallerySchema);\r\n\r\nexport default Gallery; "],"names":[],"mappings":";;;AAAA;;AAEA,MAAM,gBAAgB,IAAI,yGAAA,CAAA,UAAQ,CAAC,MAAM,CAAC;IACxC,OAAO;QACL,MAAM;QACN,UAAU;YAAC;YAAM;SAAoB;QACrC,MAAM;QACN,WAAW;YAAC;YAAK;SAA2C;IAC9D;IACA,aAAa;QACX,MAAM;QACN,UAAU;YAAC;YAAM;SAA0B;QAC3C,MAAM;QACN,WAAW;YAAC;YAAM;SAAkD;IACtE;IACA,UAAU;QACR,MAAM;QACN,UAAU;YAAC;YAAM;SAAwB;IAC3C;IACA,eAAe;QACb,MAAM;QACN,UAAU;IACZ;IACA,UAAU;QACR,MAAM;QACN,UAAU;YAAC;YAAM;SAAuB;QACxC,MAAM;YAAC;YAAa;YAAa;YAAY;YAAU;YAAe;SAAQ;QAC9E,SAAS;IACX;IACA,KAAK;QACH,MAAM;QACN,UAAU;YAAC;YAAM;SAAyC;QAC1D,MAAM;QACN,WAAW;YAAC;YAAK;SAA8C;IACjE;IACA,QAAQ;QACN,MAAM;QACN,MAAM;YAAC;YAAS;SAAY;QAC5B,SAAS;IACX;IACA,OAAO;QACL,MAAM;QACN,SAAS;IACX;IACA,UAAU;QACR,MAAM;QACN,SAAS;IACX;IACA,YAAY;QACV,MAAM;QACN,SAAS;IACX;AACF,GAAG;IACD,YAAY,KAAK,yDAAyD;AAC5E;AAEA,wCAAwC;AACxC,cAAc,KAAK,CAAC;IAAE,UAAU;IAAG,QAAQ;IAAG,WAAW,CAAC;AAAE;AAC5D,cAAc,KAAK,CAAC;IAAE,UAAU;IAAG,QAAQ;AAAE;AAC7C,cAAc,KAAK,CAAC;IAAE,OAAO;IAAQ,aAAa;AAAO;AAEzD,MAAM,UAAU,yGAAA,CAAA,UAAQ,CAAC,MAAM,CAAC,OAAO,IAAI,yGAAA,CAAA,UAAQ,CAAC,KAAK,CAAC,WAAW;uCAEtD"}},
    {"offset": {"line": 210, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 216, "column": 0}, "map": {"version":3,"sources":["file://D%3A/code/shakti-sabha/latest/ShaktiSabha/src/app/api/gallery/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport connectDB from '@/lib/mongodb';\r\nimport Gallery from '@/models/Gallery';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    \r\n    const { searchParams } = new URL(request.url);\r\n    const category = searchParams.get('category');\r\n    const status = searchParams.get('status');\r\n    const featured = searchParams.get('featured');\r\n    const limit = parseInt(searchParams.get('limit') || '0');\r\n    \r\n    // Build query\r\n    const query: Record<string, string | boolean> = {};\r\n    \r\n    if (category && category !== 'All') {\r\n      query.category = category;\r\n    }\r\n    \r\n    if (status && status !== 'all') {\r\n      query.status = status;\r\n    } else if (!status) {\r\n      // For public API, only show published by default when no status is specified\r\n      query.status = 'published';\r\n    }\r\n    // If status is 'all', don't add status filter to show all items\r\n    \r\n    if (featured === 'true') {\r\n      query.featured = true;\r\n    }\r\n    \r\n    let galleryQuery = Gallery.find(query).sort({ createdAt: -1 });\r\n    \r\n    if (limit > 0) {\r\n      galleryQuery = galleryQuery.limit(limit);\r\n    }\r\n    \r\n    const galleries = await galleryQuery.exec();\r\n    \r\n    return NextResponse.json({\r\n      success: true,\r\n      data: galleries,\r\n      count: galleries.length\r\n    });\r\n  } catch (error) {\r\n    console.error('Error fetching galleries:', error);\r\n    return NextResponse.json(\r\n      { success: false, error: 'Failed to fetch galleries' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    await connectDB();\r\n    \r\n    const body = await request.json();\r\n    const { title, description, imageUrl, imagePublicId, category, alt, status, featured } = body;\r\n    \r\n    // Validation\r\n    if (!title || !description || !imageUrl || !imagePublicId || !category || !alt) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Missing required fields' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    \r\n    const gallery = new Gallery({\r\n      title,\r\n      description,\r\n      imageUrl,\r\n      imagePublicId,\r\n      category,\r\n      alt,\r\n      status: status || 'draft',\r\n      featured: featured || false\r\n    });\r\n    \r\n    await gallery.save();\r\n    \r\n    return NextResponse.json({\r\n      success: true,\r\n      data: gallery,\r\n      message: 'Gallery item created successfully'\r\n    });\r\n  } catch (error) {\r\n    console.error('Error creating gallery item:', error);\r\n    return NextResponse.json(\r\n      { success: false, error: 'Failed to create gallery item' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n} "],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,CAAA,GAAA,uHAAA,CAAA,UAAS,AAAD;QAEd,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,WAAW,aAAa,GAAG,CAAC;QAClC,MAAM,SAAS,aAAa,GAAG,CAAC;QAChC,MAAM,WAAW,aAAa,GAAG,CAAC;QAClC,MAAM,QAAQ,SAAS,aAAa,GAAG,CAAC,YAAY;QAEpD,cAAc;QACd,MAAM,QAA0C,CAAC;QAEjD,IAAI,YAAY,aAAa,OAAO;YAClC,MAAM,QAAQ,GAAG;QACnB;QAEA,IAAI,UAAU,WAAW,OAAO;YAC9B,MAAM,MAAM,GAAG;QACjB,OAAO,IAAI,CAAC,QAAQ;YAClB,6EAA6E;YAC7E,MAAM,MAAM,GAAG;QACjB;QACA,gEAAgE;QAEhE,IAAI,aAAa,QAAQ;YACvB,MAAM,QAAQ,GAAG;QACnB;QAEA,IAAI,eAAe,0HAAA,CAAA,UAAO,CAAC,IAAI,CAAC,OAAO,IAAI,CAAC;YAAE,WAAW,CAAC;QAAE;QAE5D,IAAI,QAAQ,GAAG;YACb,eAAe,aAAa,KAAK,CAAC;QACpC;QAEA,MAAM,YAAY,MAAM,aAAa,IAAI;QAEzC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,MAAM;YACN,OAAO,UAAU,MAAM;QACzB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAA4B,GACrD;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,CAAA,GAAA,uHAAA,CAAA,UAAS,AAAD;QAEd,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,KAAK,EAAE,WAAW,EAAE,QAAQ,EAAE,aAAa,EAAE,QAAQ,EAAE,GAAG,EAAE,MAAM,EAAE,QAAQ,EAAE,GAAG;QAEzF,aAAa;QACb,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,YAAY,CAAC,iBAAiB,CAAC,YAAY,CAAC,KAAK;YAC9E,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAA0B,GACnD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,UAAU,IAAI,0HAAA,CAAA,UAAO,CAAC;YAC1B;YACA;YACA;YACA;YACA;YACA;YACA,QAAQ,UAAU;YAClB,UAAU,YAAY;QACxB;QAEA,MAAM,QAAQ,IAAI;QAElB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,MAAM;YACN,SAAS;QACX;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAAgC,GACzD;YAAE,QAAQ;QAAI;IAElB;AACF"}},
    {"offset": {"line": 311, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}